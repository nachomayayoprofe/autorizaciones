<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Autorizaciones recientes</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { font-family: Verdana; background:#f7f7f7; padding:30px; }
li { margin:6px 0; }
</style>
</head>

<body>
<h1>Ãšltimos 5 minutos</h1>
<ul id="lista"></ul>

<script>
// ðŸ”¹ FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyCAU3XI25r45i4d4zyWWxLNvKrTkg0Gs3s",
  authDomain: "autorizaciones-cc9cd.firebaseapp.com",
  databaseURL: "https://autorizaciones-cc9cd-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "autorizaciones-cc9cd",
  storageBucket: "autorizaciones-cc9cd.firebasestorage.app",
  messagingSenderId: "126656366989",
  appId: "1:126656366989:web:57b69507cf2eb84e1995c4"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function fechaLocal() {
  const d = new Date();
  return d.getFullYear() + "-" +
         String(d.getMonth()+1).padStart(2,"0") + "-" +
         String(d.getDate()).padStart(2,"0");
}

function actualizar() {
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  const ahora = new Date();
  const hace5 = new Date(ahora.getTime() - 5*60000);
  const hoy = fechaLocal();

  db.ref(`autorizaciones/${hoy}`).once("value").then(snap=>{
    if(!snap.exists()){
      lista.innerHTML="<li>No hay datos</li>";
      return;
    }

    snap.forEach(alumno=>{
      const nombre = alumno.key;
      Object.values(alumno.val()).forEach(reg=>{
        const fh = new Date(hoy+"T"+reg.hora+":00");
        if(fh>=hace5 && fh<=ahora){
          lista.innerHTML += `<li>${nombre} â†’ ${reg.hora}</li>`;
        }
      });
    });
  });
}

actualizar();
setInterval(actualizar,10000);
</script>
</body>
</html>
