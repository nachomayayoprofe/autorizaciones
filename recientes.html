<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Autorizaciones recientes</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  font-family: 'Verdana', sans-serif;
  background-color: #f0f2f5;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
  padding-top: 50px;
}

.container {
  background-color: #ffffff;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  width: 350px;
  max-width: 90%;
}

h2 {
  text-align: center;
  margin-bottom: 20px;
  color: #333;
}

ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

li {
  background-color: #f7f7f7;
  padding: 10px 12px;
  margin-bottom: 8px;
  border-radius: 8px;
  font-size: 16px;
  display: flex;
  justify-content: space-between;
  box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}

li span.hora {
  font-weight: bold;
  color: #0066cc;
}

@media(max-width: 400px){
  li {
    font-size: 14px;
    padding: 8px 10px;
  }
}
</style>
</head>

<body>
<div class="container">
<h2>Alumnos autorizados (√∫ltimos 5 minutos)</h2>
<ul id="lista">
  <li>Cargando...</li>
</ul>
</div>

<script>
// üîπ FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyCAU3XI25r45i4d4zyWWxLNvKrTkg0Gs3s",
  authDomain: "autorizaciones-cc9cd.firebaseapp.com",
  projectId: "autorizaciones-cc9cd",
  databaseURL: "https://autorizaciones-cc9cd-default-rtdb.europe-west1.firebasedatabase.app",
  storageBucket: "autorizaciones-cc9cd.firebasestorage.app",
  messagingSenderId: "126656366989",
  appId: "1:126656366989:web:57b69507cf2eb84e1995c4"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function actualizarLista() {
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  const ahora = new Date();
  const hace5 = new Date(ahora.getTime() - 5*60000);

  db.ref("autorizaciones").once("value").then(snapshot => {
    let hay = false;

    snapshot.forEach(diaSnap => {
      const fecha = diaSnap.key;

      diaSnap.forEach(alumnoSnap => {
        const alumno = alumnoSnap.key;
        const registros = alumnoSnap.val();

        Object.values(registros).forEach(reg => {
          if(!reg.hora) return;

          const fechaHora = new Date(fecha + "T" + reg.hora + ":00");

          if(fechaHora >= hace5 && fechaHora <= ahora) {
            hay = true;
            const li = document.createElement("li");
            li.innerHTML = `${alumno} <span class="hora">${reg.hora}</span>`;
            lista.appendChild(li);
          }
        });
      });
    });

    if(!hay) lista.innerHTML = "<li>No hay autorizaciones recientes</li>";
  });
}

// üîÅ Actualiza cada 10 segundos
actualizarLista();
setInterval(actualizarLista, 10000);
</script>
</body>
</html>
